{"name":"PaymentSDJpaServiceTest.java","path":"service/src/test/java/com/myhome/services/unit/PaymentSDJpaServiceTest.java","content":{"structured":{"description":"","items":[{"id":"3139eeb2-d984-4186-b5ce-1f115a74f24f","ancestors":[],"type":"function","name":"init","location":{"offset":" ","indent":2,"insert":68,"start":68},"returns":false,"params":[],"code":"@BeforeEach\n  private void init() {\n    MockitoAnnotations.initMocks(this);\n  }","skip":false,"length":4,"comment":{"description":"initializes Mockito mocks for the test class, allowing for effective unit testing.","params":[],"returns":null}},{"id":"12b8ccbe-eb1e-4fff-b795-fc7644bc738d","ancestors":[],"type":"function","name":"schedulePayment","location":{"offset":" ","indent":2,"insert":73,"start":73},"returns":false,"params":[],"code":"@Test\n  void schedulePayment() {\n    //given\n    PaymentDto basePaymentDto = TestUtils.PaymentHelpers.getTestPaymentDto(TEST_PAYMENT_CHARGE,TEST_PAYMENT_TYPE,TEST_PAYMENT_DESCRIPTION,TEST_PAYMENT_RECURRING,TEST_PAYMENT_DUEDATE,TEST_PAYMENT_USER,TEST_PAYMENT_MEMBER);\n    Payment basePayment = new Payment();\n\n    given(paymentMapper.paymentDtoToPayment(any(PaymentDto.class))).willReturn(basePayment);\n    given(paymentMapper.paymentToPaymentDto(any(Payment.class))).willReturn(basePaymentDto);\n\n    //when\n    PaymentDto testPaymentScheduled = paymentSDJpaService.schedulePayment(basePaymentDto);\n\n    //then\n    verify(adminRepository).save(any()); //Logic: User gets associated with payment and persisted\n    verify(paymentRepository).save(any(Payment.class)); //Logic: Payment is persisted\n    Assert.notNull(testPaymentScheduled.getPaymentId()); //Logic: generation of payment ID\n    assertEquals(basePaymentDto,testPaymentScheduled); //Completion: method returns what is expected\n  }","skip":false,"length":18,"comment":{"description":"maps a `PaymentDto` object to a `Payment` object, then persistently saves both the user and payment objects in the database.","params":[],"returns":null}},{"id":"749a2e4f-1590-497b-a298-9d512a7deb62","ancestors":[],"type":"function","name":"getPaymentDetails","location":{"offset":" ","indent":2,"insert":92,"start":92},"returns":false,"params":[],"code":"@Test\n  void getPaymentDetails() {\n    //when\n    PaymentDto basePaymentDto = TestUtils.PaymentHelpers.getTestPaymentDto(TEST_PAYMENT_CHARGE,TEST_PAYMENT_TYPE,TEST_PAYMENT_DESCRIPTION,TEST_PAYMENT_RECURRING,TEST_PAYMENT_DUEDATE,TEST_PAYMENT_USER,TEST_PAYMENT_MEMBER);\n    Optional<PaymentDto> optionalOfTestPaymentDto = Optional.of(basePaymentDto);\n    Payment basePayment = new Payment();\n\n    given(paymentRepository.findByPaymentId(anyString())).willReturn(Optional.of(basePayment));\n    given(paymentMapper.paymentToPaymentDto(any(Payment.class))).willReturn(basePaymentDto);\n\n    //when\n    Optional<PaymentDto> testPaymentDetails = paymentSDJpaService.getPaymentDetails(\"any-id\");\n\n    //then\n    verify(paymentRepository).findByPaymentId(anyString()); //Logic: fetching data\n    assertTrue(testPaymentDetails.isPresent()); //Logic: element is present\n    assertEquals(optionalOfTestPaymentDto,testPaymentDetails); //Completion: method returns what is expected\n  }","skip":false,"length":18,"comment":{"description":"retrieves a PaymentDto object with payment details given an ID. It fetches data from the repository and maps it to the expected PaymentDto format using the mapper.","params":[],"returns":null}},{"id":"94d32058-25b3-48ff-83c4-0217cda032e6","ancestors":[],"type":"function","name":"getHouseMember","location":{"offset":" ","indent":2,"insert":111,"start":111},"returns":false,"params":[],"code":"@Test\n  void getHouseMember() {\n    //given\n    HouseMember baseHouseMember = TestUtils.HouseMemberHelpers.getTestHouseMember();\n    Optional<HouseMember> baseHouseMemberOptional = Optional.of(baseHouseMember);\n\n    given(houseMemberRepository.findByMemberId(anyString())).willReturn(\n        Optional.of(baseHouseMember));\n\n    //when\n    Optional<HouseMember> testHouseMember = paymentSDJpaService.getHouseMember(\"any-id\");\n\n    //then\n    verify(houseMemberRepository).findByMemberId(anyString()); //Logic: fetching data\n    assertTrue(testHouseMember.isPresent()); //Completion: element is present\n    assertEquals(baseHouseMemberOptional,testHouseMember); //Completion: method returns what is expected\n  }","skip":false,"length":17,"comment":{"description":"fetches a HouseMember object from the repository based on a given member ID.","params":[],"returns":null}},{"id":"84acc8b5-0dc9-4a77-9271-ffda1ae76851","ancestors":[],"type":"function","name":"getPaymentsByMember","location":{"offset":" ","indent":2,"insert":129,"start":129},"returns":false,"params":[],"code":"@Test\n  void getPaymentsByMember() {\n    //given\n    String memberId1 = \"memberId-test-1\";\n    String memberId2 = \"memberId-test-2\";\n    Payment paymentExample1 = TestUtils.PaymentHelpers.getTestPaymentNullFields();\n    paymentExample1.setMember(new HouseMember().withMemberId(memberId1));\n    Payment paymentExample2 = TestUtils.PaymentHelpers.getTestPaymentNullFields();\n    paymentExample2.setMember(new HouseMember().withMemberId(memberId2));\n\n    Set<Payment> expectedReturn1 = new HashSet<>(); expectedReturn1.add(paymentExample1);\n    given(paymentRepository.findAll(any(Example.class))).willReturn(Collections.singletonList((paymentExample1)));\n\n    //when\n    Set<Payment> testPaymentByMember1 = paymentSDJpaService.getPaymentsByMember(memberId1);\n    verify(paymentRepository).findAll(exampleCaptor.capture()); //verify and capture first execution\n    Example<Payment> capturedParameter1 = exampleCaptor.getValue(); //Capturing the 'paymentExample' created by the method\n    Payment capturedPaymentExample1 = capturedParameter1.getProbe();\n\n    Set<Payment> testPaymentByMember2 = paymentSDJpaService.getPaymentsByMember(memberId2);\n    verify(paymentRepository,times(2)).findAll(exampleCaptor.capture()); //verify and capture second execution\n    Example<Payment> capturedParameter2 = exampleCaptor.getValue(); // Capturing the 'paymentExample' created by the method\n    Payment capturedPaymentExample2 = capturedParameter2.getProbe();\n\n    //then\n    verify(paymentRepository,times(2)).findAll(any(Example.class)); //Logic: two executions of method\n    assertEquals(memberId1,capturedPaymentExample1.getMember().getMemberId()); //Logic: memberId from captured element is the same passed on as parameter in method\n    assertEquals(memberId2,capturedPaymentExample2.getMember().getMemberId()); //Logic: memberId from captured element is the same passed on as parameter in method\n    assertEquals(paymentExample1,capturedPaymentExample1); //Logic: fields in captured element should be as expected\n    assertEquals(paymentExample2,capturedPaymentExample2); //Logic: fields in captured element should be as expected\n    assertEquals(expectedReturn1,testPaymentByMember1); //Completion: method returns what is expected\n  }","skip":false,"length":32,"comment":{"description":"retrieves payments associated with a given member ID from the repository and returns them.","params":[],"returns":null}},{"id":"d64fb33c-419a-47b9-926d-a5e72143336a","ancestors":[],"type":"function","name":"getPaymentsByAdmin","location":{"offset":" ","indent":2,"insert":162,"start":162},"returns":false,"params":[],"code":"@Test\n  void getPaymentsByAdmin() {\n    //given\n    String userId1 = \"userId-test-1\";\n    String userId2 = \"userId-test-2\";\n    Payment paymentExample1 = TestUtils.PaymentHelpers.getTestPaymentNullFields();\n    paymentExample1.setAdmin(new User().withUserId(userId1));\n    Payment paymentExample2 = TestUtils.PaymentHelpers.getTestPaymentNullFields();\n    paymentExample2.setAdmin(new User().withUserId(userId2));\n\n    Pageable pageable = Mockito.mock(Pageable.class);\n\n    Page<Payment> expectedReturn1 = new PageImpl<Payment>(Collections.singletonList(paymentExample1));\n    given(paymentRepository.findAll(any(Example.class),any(Pageable.class))).willReturn(expectedReturn1);\n\n    //when\n    Page<Payment> testPaymentByAdmin1 = paymentSDJpaService.getPaymentsByAdmin(userId1,pageable);\n    verify(paymentRepository).findAll((Example<Payment>) exampleCaptor.capture(), any(Pageable.class)); //verify and capture first execution\n    Example<Payment> capturedParameter1 = exampleCaptor.getValue(); //Capturing the 'paymentExample' created by method\n    Payment capturedPaymentExample1 = capturedParameter1.getProbe();\n\n    Page<Payment> testPaymentByAdmin2 = paymentSDJpaService.getPaymentsByAdmin(userId2,pageable);\n    verify(paymentRepository,times(2)).findAll((Example<Payment>) exampleCaptor.capture(), any(Pageable.class)); //verify and capture first execution\n    Example<Payment> capturedParameter2 = exampleCaptor.getValue(); // Capturing the 'paymentExample' created by method\n    Payment capturedPaymentExample2 = capturedParameter2.getProbe();\n\n    //then\n    verify(paymentRepository,times(2)).findAll(any(Example.class),any(Pageable.class)); //Logic: two executions of method\n    assertEquals(userId1,capturedPaymentExample1.getAdmin().getUserId()); //Logic: userId from captured element is the same passed on as parameter in method\n    assertEquals(userId2,capturedPaymentExample2.getAdmin().getUserId()); //Logic: userId from captured element is the same passed on as parameter in method\n    assertEquals(paymentExample1,capturedPaymentExample1); //Logic: fields in captured element should be as expected\n    assertEquals(paymentExample2,capturedPaymentExample2); //Logic: fields in captured element should be as expected\n    assertEquals(expectedReturn1,testPaymentByAdmin1); //Completion: method returns what is expected\n  }","skip":false,"length":34,"comment":{"description":"queries the payment repository to retrieve payments associated with a given admin user ID, and returns them in a pageable format.","params":[],"returns":null}}]}}}