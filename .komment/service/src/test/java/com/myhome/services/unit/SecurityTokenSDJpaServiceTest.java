{"name":"SecurityTokenSDJpaServiceTest.java","path":"service/src/test/java/com/myhome/services/unit/SecurityTokenSDJpaServiceTest.java","content":{"structured":{"description":"","image":"<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"\n \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<!-- Generated by graphviz version 2.43.0 (0)\n -->\n<!-- Title: com.myhome.domain.SecurityToken Pages: 1 -->\n<svg width=\"187pt\" height=\"148pt\"\n viewBox=\"0.00 0.00 187.00 148.00\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n<g id=\"graph0\" class=\"graph\" transform=\"scale(1 1) rotate(0) translate(4 144)\">\n<title>com.myhome.domain.SecurityToken</title>\n<!-- Node1 -->\n<g id=\"Node000001\" class=\"node\">\n<title>Node1</title>\n<g id=\"a_Node000001\"><a xlink:title=\" \">\n<polygon fill=\"#999999\" stroke=\"#666666\" points=\"173,-30 6,-30 6,0 173,0 173,-30\"/>\n<text text-anchor=\"start\" x=\"14\" y=\"-18\" font-family=\"Helvetica,sans-Serif\" font-size=\"10.00\">com.myhome.domain.Security</text>\n<text text-anchor=\"middle\" x=\"89.5\" y=\"-7\" font-family=\"Helvetica,sans-Serif\" font-size=\"10.00\">Token</text>\n</a>\n</g>\n</g>\n<!-- Node2 -->\n<g id=\"Node000002\" class=\"node\">\n<title>Node2</title>\n<g id=\"a_Node000002\"><a xlink:href=\"classcom_1_1myhome_1_1domain_1_1BaseEntity.html\" target=\"_top\" xlink:title=\" \">\n<polygon fill=\"white\" stroke=\"#666666\" points=\"179,-85 0,-85 0,-66 179,-66 179,-85\"/>\n<text text-anchor=\"middle\" x=\"89.5\" y=\"-73\" font-family=\"Helvetica,sans-Serif\" font-size=\"10.00\">com.myhome.domain.BaseEntity</text>\n</a>\n</g>\n</g>\n<!-- Node2&#45;&gt;Node1 -->\n<g id=\"edge1_Node000001_Node000002\" class=\"edge\">\n<title>Node2&#45;&gt;Node1</title>\n<g id=\"a_edge1_Node000001_Node000002\"><a xlink:title=\" \">\n<path fill=\"none\" stroke=\"#63b8ff\" d=\"M89.5,-55.65C89.5,-47.36 89.5,-37.78 89.5,-30.11\"/>\n<polygon fill=\"#63b8ff\" stroke=\"#63b8ff\" points=\"86,-55.87 89.5,-65.87 93,-55.87 86,-55.87\"/>\n</a>\n</g>\n</g>\n<!-- Node3 -->\n<g id=\"Node000003\" class=\"node\">\n<title>Node3</title>\n<g id=\"a_Node000003\"><a xlink:title=\" \">\n<polygon fill=\"white\" stroke=\"#666666\" points=\"126.5,-140 52.5,-140 52.5,-121 126.5,-121 126.5,-140\"/>\n<text text-anchor=\"middle\" x=\"89.5\" y=\"-128\" font-family=\"Helvetica,sans-Serif\" font-size=\"10.00\">Serializable</text>\n</a>\n</g>\n</g>\n<!-- Node3&#45;&gt;Node2 -->\n<g id=\"edge2_Node000002_Node000003\" class=\"edge\">\n<title>Node3&#45;&gt;Node2</title>\n<g id=\"a_edge2_Node000002_Node000003\"><a xlink:title=\" \">\n<path fill=\"none\" stroke=\"#63b8ff\" d=\"M89.5,-110.66C89.5,-101.93 89.5,-91.99 89.5,-85.09\"/>\n<polygon fill=\"#63b8ff\" stroke=\"#63b8ff\" points=\"86,-110.75 89.5,-120.75 93,-110.75 86,-110.75\"/>\n</a>\n</g>\n</g>\n</g>\n</svg>\n","items":[{"id":"78d45611-e6bb-4c5d-8944-8613ae6e01d1","ancestors":[],"type":"function","name":"init","location":{"offset":" ","indent":2,"insert":37,"start":37},"returns":false,"params":[],"code":"@BeforeEach\n  private void init() {\n    MockitoAnnotations.initMocks(this);\n    ReflectionTestUtils.setField(securityTokenSDJpaService, \"passResetTokenTime\",\n        TEST_TOKEN_LIFETIME_SECONDS);\n    ReflectionTestUtils.setField(securityTokenSDJpaService, \"emailConfirmTokenTime\",\n        TEST_TOKEN_LIFETIME_SECONDS);\n  }","skip":false,"length":8,"comment":{"description":"sets fields on a security token SD Jpa service, including the pass reset token time and email confirm token time, using ReflectionTestUtils.","params":[],"returns":null}},{"id":"5d49dd51-6c36-48c6-adb1-89de0da57bfa","ancestors":[],"type":"function","name":"createSecurityToken","location":{"offset":" ","indent":2,"insert":46,"start":46},"returns":false,"params":[],"code":"@Test\n  void createSecurityToken() {\n    // given\n    User user = new User();\n    user.setUserId(TestUtils.General.generateUniqueId());\n    SecurityTokenType testTokenType = SecurityTokenType.RESET;\n    when(securityTokenRepository.save(any()))\n        .then(returnsFirstArg());\n\n    // when\n    SecurityToken actualSecurityToken = securityTokenSDJpaService.createPasswordResetToken(user);\n    LocalDate creationDate = actualSecurityToken.getCreationDate();\n    LocalDate expiryDate = actualSecurityToken.getExpiryDate();\n    Duration lifetime = Duration.between(creationDate.atStartOfDay(), expiryDate.atStartOfDay());\n\n    // then\n    assertEquals(actualSecurityToken.getTokenType(), testTokenType);\n    assertTrue(creationDate.isBefore(expiryDate));\n    assertEquals(lifetime, TEST_TOKEN_LIFETIME_SECONDS);\n    assertEquals(user, actualSecurityToken.getTokenOwner());\n    assertNotNull(actualSecurityToken.getToken());\n    verify(securityTokenRepository).save(any());\n  }","skip":false,"length":23,"comment":{"description":"creates a new security token for a user based on their unique ID and security token type, saves it to the repository, and returns the token object with relevant information such as creation date, expiry date, lifetime, owner, and token.","params":[],"returns":null}},{"id":"43eac1c0-f8f8-457d-80b8-74c848047c37","ancestors":[],"type":"function","name":"createPasswordResetToken","location":{"offset":" ","indent":2,"insert":70,"start":70},"returns":false,"params":[],"code":"@Test\n  void createPasswordResetToken() {\n    // given\n    User user = new User();\n    user.setUserId(TestUtils.General.generateUniqueId());\n    when(securityTokenRepository.save(any()))\n        .then(returnsFirstArg());\n\n    // when\n    SecurityToken actualSecurityToken = securityTokenSDJpaService.createPasswordResetToken(user);\n    LocalDate creationDate = actualSecurityToken.getCreationDate();\n    LocalDate expiryDate = actualSecurityToken.getExpiryDate();\n    Duration lifetime = Duration.between(creationDate.atStartOfDay(), expiryDate.atStartOfDay());\n\n    // then\n    assertEquals(actualSecurityToken.getTokenType(), SecurityTokenType.RESET);\n    assertTrue(creationDate.isBefore(expiryDate));\n    assertEquals(lifetime, TEST_TOKEN_LIFETIME_SECONDS);\n    assertEquals(user, actualSecurityToken.getTokenOwner());\n    assertNotNull(actualSecurityToken.getToken());\n    verify(securityTokenRepository).save(any());\n  }","skip":false,"length":22,"comment":{"description":"creates a new security token for password reset and saves it to the repository, returning the created token.","params":[],"returns":null}},{"id":"60c9f647-18ca-4fa1-8668-37b057d14c28","ancestors":[],"type":"function","name":"createEmailConfirmToken","location":{"offset":" ","indent":2,"insert":93,"start":93},"returns":false,"params":[],"code":"@Test\n  void createEmailConfirmToken() {\n    // given\n    User user = new User();\n    user.setUserId(TestUtils.General.generateUniqueId());\n    when(securityTokenRepository.save(any()))\n        .then(returnsFirstArg());\n\n    // when\n    SecurityToken actualSecurityToken = securityTokenSDJpaService.createEmailConfirmToken(user);\n    LocalDate creationDate = actualSecurityToken.getCreationDate();\n    LocalDate expiryDate = actualSecurityToken.getExpiryDate();\n    Duration lifetime = Duration.between(creationDate.atStartOfDay(), expiryDate.atStartOfDay());\n\n    // then\n    assertEquals(actualSecurityToken.getTokenType(), SecurityTokenType.EMAIL_CONFIRM);\n    assertTrue(creationDate.isBefore(expiryDate));\n    assertEquals(lifetime, TEST_TOKEN_LIFETIME_SECONDS);\n    assertEquals(user, actualSecurityToken.getTokenOwner());\n    assertNotNull(actualSecurityToken.getToken());\n    verify(securityTokenRepository).save(any());\n  }","skip":false,"length":22,"comment":{"description":"creates an email confirm token for a user, sets its properties, and saves it to the repository.","params":[],"returns":null}}]}}}